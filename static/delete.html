<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Delete Entries</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoI...."
      crossorigin="anonymous"
    />
  </head>
  <body>
    <br />
    <h1>
      <center><b>Welcome To The Parking Management System</b></center>
    </h1>
    <br />

    <nav class="navbar navbar-expand-lg bg-body-tertiary">
      <div class="container-fluid">
        <a class="navbar-brand"><b>Admin Dashboard</b></a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="system.html"
                >Home</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="homepage.html">Logout</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <br>
    <br>

    <!-- Adding a search form to enter person ID -->
    <form id="search-form" class="d-flex" role="search">
      <input
        id="person-id"
        class="form-control me-2"
        type="search"
        placeholder="Enter the Person ID"
        aria-label="Search"
      />
      <button class="btn btn-outline-success" type="submit">Search</button>
    </form>
    <br>
    <br>

    <!-- Displaying the person's data in a table format -->
    <div id="person-data" style="display: none">
      <h2><center>Person Details</center></h2>
      <br />
      <br />
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>Person ID</th>
            <th>Visitor Name</th>
            <th>Visitor Type</th>
            <th>Vehicle ID</th>
            <th>Vehicle Type</th>
            <th>Vehicle Number</th>
            <th>Duration ID</th>
            <th>Stay Duration</th>
          </tr>
        </thead>
        <tbody id="person-data-body">
          <tr>
            <td id="person-id-value"></td>
            <td id="person-name-value"></td>
            <td id="visitor-type-value"></td>
            <td id="vehicle-id-value"></td>
            <td id="vehicle-type-value"></td>
            <td id="vehicle-number-value"></td>
            <td id="duration-id-value"></td>
            <td id="stay-duration-value"></td>
          </tr>
        </tbody>
      </table>
    </div>
    <br />
    <br />

    <script>
      document.getElementById("search-form").addEventListener(
        "submit",
        async (event) => {
          event.preventDefault();
          const personId = document.getElementById("person-id").value;

          try {
            const response = await fetch("/graphql/", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Accept: "application/json",
              },
              body: JSON.stringify({
                query: `
                  query getPerson($person_id: Int!) {
                    getPerson(id: $person_id) {
                      user {
                        id person_name visitor_type
                      }
                      vehicle {
                        id vehicle_type vehicle_number person_id
                      }
                      duration {
                        id stay_duration person_id vehicle_id
                      }
                    }
                  }
                `,
                variables: {
                  person_id: parseInt(personId),
                },
              }),
            });
            const data = await response.json();
            console.log(data);

            // Check if the response contains the data
            if (data.data && data.data.getPerson) {
              const personData = data.data.getPerson;

              // Populate the table with the retrieved data
              document.getElementById("person-id-value").textContent = personId;
              document.getElementById("person-name-value").textContent =
                personData.user.person_name;
              document.getElementById("visitor-type-value").textContent =
                personData.user.visitor_type;
              document.getElementById("vehicle-id-value").textContent =
                personData.vehicle.id;
              document.getElementById("vehicle-type-value").textContent =
                personData.vehicle.vehicle_type;
              document.getElementById("vehicle-number-value").textContent =
                personData.vehicle.vehicle_number;
              document.getElementById("duration-id-value").textContent =
                personData.duration.id;
              document.getElementById("stay-duration-value").textContent =
                personData.duration.stay_duration;

              // Display the table
              document.getElementById("person-data").style.display = "block";
            }
          } catch (error) {
            console.error("Error creating entry:", error);
          }
        }
      );
    </script>

    <center>
      <button
        type="button"
        class="btn btn-danger"
        onclick="redirectToUpdatingEntries()"
      >
        Delete Entry
      </button>
    </center>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
